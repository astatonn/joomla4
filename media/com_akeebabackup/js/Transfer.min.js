"use strict";if("undefined"==typeof akeebabackup)var akeebabackup={};"undefined"==typeof akeebabackup.Transfer&&(akeebabackup.Transfer={lastUrl:"",lastResult:"",FtpTest:{},SftpTest:{},FtpModal:null,URLs:{},translations:{}}),akeebabackup.Transfer.onUrlChange=function(a){void 0===a&&(a=!1);var b=document.getElementById("akeeba-transfer-url"),c=b.value;""==c&&(document.getElementById("akeeba-transfer-lbl-url").style.display="block"),"http://"!==c.substring(0,7)&&"https://"!==c.substring(0,8)&&(c="http://"+c);var d=akeebabackup.Transfer.lastUrl?akeebabackup.Transfer.lastUrl:Joomla.getOptions("akeebabackup.Transfer.lastUrl",""),e=akeebabackup.Transfer.lastResult?akeebabackup.Transfer.lastResult:Joomla.getOptions("akeebabackup.Transfer.lastResult","");if(!a&&c===d)return void akeebabackup.Transfer.applyUrlCheck({status:e,url:d});for(var f=document.querySelectorAll("#akeeba-transfer-row-url > div"),g=0;g<f.length;g++)f[g].style.display="none";return b.setAttribute("disabled","disabled"),document.getElementById("akeeba-transfer-btn-url").setAttribute("disabled","disabled"),document.getElementById("akeeba-transfer-loading").style.display="",akeebabackup.System.doAjax({task:"checkUrl",url:c},akeebabackup.Transfer.applyUrlCheck,function(){b.removeAttribute("disabled"),document.getElementById("akeeba-transfer-btn-url").removeAttribute("disabled"),document.getElementById("akeeba-transfer-loading").style.display="none"},!1,1e4),!1},akeebabackup.Transfer.applyUrlCheck=function(a){var b=document.getElementById("akeeba-transfer-url");switch(b.removeAttribute("disabled"),document.getElementById("akeeba-transfer-btn-url").removeAttribute("disabled"),document.getElementById("akeeba-transfer-loading").style.display="none",document.getElementById("akeeba-transfer-ftp-container").style.display="none",b.value=a.url,akeebabackup.Transfer.lastResult=a.status,akeebabackup.Transfer.lastUrl=a.url,a.status){case"ok":akeebabackup.Transfer.showConnectionDetails();break;case"same":document.getElementById("akeeba-transfer-err-url-same").style.display="";break;case"invalid":document.getElementById("akeeba-transfer-err-url-invalid").style.display="";break;case"notexists":document.getElementById("akeeba-transfer-err-url-notexists").style.display="";}},akeebabackup.Transfer.showConnectionDetails=function(){return document.getElementById("akeeba-transfer-url").setAttribute("disabled","disabled"),document.getElementById("akeeba-transfer-btn-url").setAttribute("disabled","disabled"),document.getElementById("akeeba-transfer-err-url-notexists").style.display="none",document.getElementById("akeeba-transfer-ftp-container").style.display="",akeebabackup.Transfer.onTransferMethodChange(),!1},akeebabackup.Transfer.onTransferMethodChange=function(){var a=document.getElementById("akeeba-transfer-ftp-method"),b=a.options[a.selectedIndex].value;return document.getElementById("akeeba-transfer-ftp-host").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-port").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-username").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-password").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-pubkey").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-privatekey").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-directory").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-passive-container").style.display="none",document.getElementById("akeeba-transfer-ftp-passive-fix-container").style.display="none",document.getElementById("akeeba-transfer-chunkmode").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-chunksize").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-apply-loading").style.display="none","manual"!==b&&(document.getElementById("akeeba-transfer-ftp-host").parentNode.parentNode.style.display="",document.getElementById("akeeba-transfer-ftp-port").parentNode.parentNode.style.display="",document.getElementById("akeeba-transfer-ftp-username").parentNode.parentNode.style.display="",document.getElementById("akeeba-transfer-ftp-password").parentNode.parentNode.style.display="",document.getElementById("akeeba-transfer-ftp-directory").parentNode.parentNode.style.display="",document.getElementById("akeeba-transfer-chunkmode").parentNode.parentNode.style.display="",document.getElementById("akeeba-transfer-chunksize").parentNode.parentNode.style.display="",document.getElementById("akeeba-transfer-btn-apply").parentNode.parentNode.style.display="",document.getElementById("akeeba-transfer-manualtransfer").style.display="none"),"manual"===b?(document.getElementById("akeeba-transfer-btn-apply").parentNode.parentNode.style.display="none",void(document.getElementById("akeeba-transfer-manualtransfer").style.display="")):void(("ftp"===b||"ftps"===b||"ftpcurl"===b||"ftpscurl"===b)&&(document.getElementById("akeeba-transfer-ftp-passive-container").style.display=""),("ftpcurl"===b||"ftpscurl"===b)&&(document.getElementById("akeeba-transfer-ftp-passive-fix-container").style.display=""),("sftp"===b||"sftpcurl"===b)&&(document.getElementById("akeeba-transfer-ftp-pubkey").parentNode.parentNode.style.display="",document.getElementById("akeeba-transfer-ftp-privatekey").parentNode.parentNode.style.display=""))},akeebabackup.Transfer.applyConnection=function(){document.getElementById("akeeba-transfer-ftp-error").style.display="none",document.getElementById("akeeba-transfer-apply-loading").style.display="";var a=document.getElementById("akeeba-transfer-btn-apply");a.setAttribute("disabled","disabled"),document.getElementById("akeeba-transfer-ftp-method").setAttribute("disabled","disabled"),document.getElementById("akeeba-transfer-ftp-host").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-port").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-username").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-password").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-pubkey").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-privatekey").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-directory").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-ftp-passive-container").style.display="none",document.getElementById("akeeba-transfer-ftp-passive-fix-container").style.display="none",document.getElementById("akeeba-transfer-chunkmode").parentNode.parentNode.style.display="none",document.getElementById("akeeba-transfer-chunksize").parentNode.parentNode.style.display="none";var b=document.getElementById("akeeba-transfer-ftp-method"),c=b.options[b.selectedIndex].value;if("manual"===c)return document.getElementById("akeeba-transfer-btn-apply").parentNode.parentNode.style.display="none",void(document.getElementById("akeeba-transfer-manualtransfer").style.display="");var d={task:"applyConnection",method:c,host:document.getElementById("akeeba-transfer-ftp-host").value,port:document.getElementById("akeeba-transfer-ftp-port").value,username:document.getElementById("akeeba-transfer-ftp-username").value,password:document.getElementById("akeeba-transfer-ftp-password").value,directory:document.getElementById("akeeba-transfer-ftp-directory").value,passive:document.getElementById("akeeba-transfer-ftp-passive1").checked?1:0,passive_fix:document.getElementById("akeeba-transfer-ftp-passive-fix1").checked?1:0,privateKey:document.getElementById("akeeba-transfer-ftp-privatekey").value,publicKey:document.getElementById("akeeba-transfer-ftp-pubkey").value,chunkMode:document.getElementById("akeeba-transfer-chunkmode").value,chunkSize:document.getElementById("akeeba-transfer-chunksize").value};akeebabackup.System.doAjax(d,function(a){if(document.getElementById("akeeba-transfer-apply-loading").style.display="none",!a.status){document.getElementById("akeeba-transfer-btn-apply").removeAttribute("disabled"),document.getElementById("akeeba-transfer-ftp-method").removeAttribute("disabled");var b=document.getElementById("akeeba-transfer-ftp-error"),c=document.getElementById("akeeba-transfer-ftp-error-body"),d=document.getElementById("akeeba-transfer-ftp-error-force");return d&&(d.style.display="none",a.ignorable&&(d.style.display="")),c.innerHTML=a.message,b.style.display="",akeebabackup.System.triggerEvent(b,"focus"),void akeebabackup.Transfer.onTransferMethodChange()}akeebabackup.Transfer.uploadKickstart()},function(){document.getElementById("akeeba-transfer-apply-loading").style.display="none",document.getElementById("akeeba-transfer-btn-apply").removeAttribute("disabled"),document.getElementById("akeeba-transfer-ftp-method").removeAttribute("disabled");var a=document.getElementById("akeeba-transfer-ftp-error"),b=document.getElementById("akeeba-transfer-ftp-error-body");b.textContent=Joomla.Text._("COM_AKEEBABACKUP_CONFIG_DIRECTFTP_TEST_FAIL"),a.style.display="",akeebabackup.System.triggerEvent(a,"focus"),akeebabackup.Transfer.onTransferMethodChange()},!1,15e3)},akeebabackup.Transfer.uploadKickstart=function(){var a=document.getElementById("akeeba-transfer-upload-lbl-kickstart"),b=document.getElementById("akeeba-transfer-upload-lbl-archive"),c=document.getElementById("akeeba-transfer-upload-error"),d=document.getElementById("akeeba-transfer-upload-error-body"),e=document.getElementById("akeeba-transfer-upload-error-force");c.style.display="none",e.style.display="none",d.innerHTML="",a.classList.remove("bg-light"),a.classList.add("bg-warning"),b.classList.remove("bg-warning"),b.classList.add("bg-light"),document.getElementById("akeeba-transfer-upload-area-kickstart").style.display="none",document.getElementById("akeeba-transfer-upload-area-upload").style.display="",document.getElementById("akeeba-transfer-upload").style.display="";akeebabackup.System.doAjax({task:"initialiseUpload"},function(b){return b.status?void akeebabackup.Transfer.uploadArchive(1):(e&&(e.style.display="none",b.ignorable&&(e.style.display="")),a.classList.remove("bg-warning"),a.classList.add("bg-danger","text-white"),d.innerHTML=b.message,void(c.style.display=""))},null,!1,15e4)},akeebabackup.Transfer.uploadArchive=function(a){a===void 0&&(a=0);var b=document.getElementById("akeeba-transfer-upload-lbl-kickstart"),c=document.getElementById("akeeba-transfer-upload-lbl-archive"),d=document.getElementById("akeeba-transfer-upload-error"),e=document.getElementById("akeeba-transfer-upload-error-body");e.innerHTML="",d.style.display="none",b.classList.remove("bg-light","bg-warning"),b.classList.add("bg-success","text-white"),c.classList.remove("bg-light"),c.classList.add("bg-warning");var f={task:"upload",start:a};akeebabackup.System.doAjax(f,function(a){if(!a.result)return c.classList.remove("bg-warning"),c.classList.add("bg-danger","text-white"),e.innerHTML=a.message,void(d.style.display="");if(a.done){document.getElementById("akeeba-transfer-upload-percent").textContent="100 %",document.getElementById("akeeba-transfer-upload-size").innerHTML="",document.getElementById("akeeba-transfer-upload-area-kickstart").style.display="",document.getElementById("akeeba-transfer-upload-area-upload").style.display="none";var b=document.getElementById("akeeba-transfer-url"),f=b.value.replace(/\/$/,"")+"/kickstart.php";return void document.getElementById("akeeba-transfer-upload-btn-kickstart").setAttribute("href",f)}var g=0,h=1*a.totalSize,i=1*a.doneSize;0<h&&0<i&&(g=100*(i/h)),document.getElementById("akeeba-transfer-upload-percent").textContent=g.toFixed(2)+"%",document.getElementById("akeeba-transfer-upload-size").textContent=i.toFixed(0)+" / "+h.toFixed(0)+" bytes",window.setTimeout(function(){akeebabackup.Transfer.uploadArchive(0)},50)},null,!1,15e4)},akeebabackup.Transfer.testFtpSftpConnection=function(){var a=document.getElementById("akeeba-transfer-ftp-method"),b=a.options[a.selectedIndex].value;return"ftp"===b||"ftps"===b||"ftpcurl"===b||"ftpscurl"===b?akeebabackup.Transfer.FtpTest.testConnection("akeeba-transfer-btn-testftp"):("sftp"===b||"sftpcurl"===b)&&akeebabackup.Transfer.SftpTest.testConnection("akeeba-transfer-btn-testftp"),!1},akeebabackup.System.documentReady(function(){document.getElementById("akeeba-transfer-ftp-method").addEventListener("change",akeebabackup.Transfer.onTransferMethodChange),document.getElementById("akeeba-transfer-btn-url").addEventListener("click",function(a){return a.preventDefault(),akeebabackup.Transfer.onUrlChange(!0),!1}),document.getElementById("akeeba-transfer-url").value&&akeebabackup.Transfer.onUrlChange(),document.getElementById("akeeba-transfer-ftp-method").addEventListener("change",akeebabackup.Transfer.onTransferMethodChange),document.getElementById("akeeba-transfer-btn-apply").addEventListener("click",akeebabackup.Transfer.applyConnection),document.getElementById("akeeba-transfer-err-url-notexists-btn-ignore").addEventListener("click",akeebabackup.Transfer.showConnectionDetails)});
//# sourceMappingURL=Transfer.min.js.map