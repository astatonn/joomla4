"use strict";if("undefined"==typeof akeebabackup)var akeebabackup={};"undefined"==typeof akeebabackup.Backup&&(akeebabackup.Backup={tag:"",backupid:null,currentDomain:null,returnUrl:"",timeoutTimer:null,resumeTimer:null,resume:{retry:0,showWarnings:0}}),akeebabackup.Backup.timer=function(a){0>=a&&(a=10),setTimeout(akeebabackup.Backup.timerTick,a)},akeebabackup.Backup.timerTick=function(){try{console.log("Timer tick")}catch(a){}akeebabackup.Backup.resetTimeoutBar();var a=Joomla.getOptions("akeebabackup.Backup.maxExecutionTime",14),b=Joomla.getOptions("akeebabackup.Backup.runtimeBias",75);akeebabackup.Backup.startTimeoutBar(a,b),akeebabackup.System.doAjax({ajax:"step",tag:akeebabackup.Backup.tag,backupid:akeebabackup.Backup.backupid},akeebabackup.Backup.onStep,akeebabackup.Backup.onError,!1)},akeebabackup.Backup.startTimeoutBar=function(){var a=0;akeebabackup.Backup.timeoutTimer=setInterval(function(){a++;var b=document.querySelector("#response-timer div.text");b&&(b.textContent=Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_LASTRESPONSE").replace("%s",a.toFixed(0)))},1e3)},akeebabackup.Backup.resetTimeoutBar=function(){try{clearInterval(akeebabackup.Backup.timeoutTimer)}catch(a){}var a=document.querySelector("#response-timer div.text");a&&(a.textContent=Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_LASTRESPONSE").replace("%s","0"))},akeebabackup.Backup.startRetryTimeoutBar=function(){var a=Joomla.getOptions("akeebabackup.Backup.resume.timeout",10);akeebabackup.Backup.resumeTimer=setInterval(function(){a--,document.getElementById("akeebabackup-retry-timeout").textContent=a.toFixed(0),0===a&&(clearInterval(akeebabackup.Backup.resumeTimer),akeebabackup.Backup.resumeBackup())},1e3)},akeebabackup.Backup.resetRetryTimeoutBar=function(){clearInterval(akeebabackup.Backup.resumeTimer);var a=Joomla.getOptions("akeebabackup.Backup.resume.timeout",10);document.getElementById("akeebabackup-retry-timeout").textContent=a.toFixed(0)},akeebabackup.Backup.renderBackupSteps=function(a){var b="bg-success text-white";""==a&&(b="bg-light"),document.getElementById("backup-steps").innerHTML="";for(var c=Joomla.getOptions("akeebabackup.Backup.domains",{}),d=0;d<c.length;d++){var e=c[d],f=document.createElement("div");if(f.className="mt-1 mb-1 p-1 border rounded",f.innerHTML=e[1],document.getElementById("backup-steps").appendChild(f),e[0]==a)b="bg-light",g="bg-primary text-white";else var g=b;f.className+=" "+g}},akeebabackup.Backup.start=function(){try{console.log("Starting backup"),console.log(data)}catch(a){}if(window.AVGRUN){try{console.warn("AVG Antivirus with Link Checker detected. The backup WILL fail!")}catch(a){}var a=confirm(Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_AVGWARNING"));if(!a)return!1}document.getElementById("backup-setup").style.display="none",document.getElementById("backup-progress-pane").style.display="block";var b=Joomla.getOptions("akeebabackup.Backup.hasAngieKey",!1);b&&(document.getElementById("angie-password-warning").style.display="block");var c=new Date;akeebabackup.System.notification.notify(Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_BACKUPSTARTED")+" "+c.toLocaleString()),akeebabackup.Backup.renderBackupSteps("");var d=Joomla.getOptions("akeebabackup.Backup.maxExecutionTime",14),e=Joomla.getOptions("akeebabackup.Backup.runtimeBias",75);akeebabackup.Backup.startTimeoutBar(d,e);var f={ajax:"start",description:document.getElementById("backup-description").value,comment:document.getElementById("comment").value};return akeebabackup.System.doAjax(f,akeebabackup.Backup.onStep,akeebabackup.Backup.onError,!1),!1},akeebabackup.Backup.onStep=function(a){try{console.log("Running backup step"),console.log(a)}catch(a){}akeebabackup.Backup.renderBackupSteps(a.Domain),akeebabackup.Backup.currentDomain=a.Domain;var b=a.Progress+"%",c=document.querySelector("#backup-percentage div.progress-bar");if(c.style.width=a.Progress+"%",c.setAttribute("aria-valuenow",b),c.innerHTML=b,document.getElementById("backup-step").textContent=a.Step,document.getElementById("backup-substep").textContent=a.Substep,a.Warnings=a.Warnings||[],0<a.Warnings.length){var d=document.getElementById("backup-percentage").className;-1==d.indexOf("bg-warning")&&(document.getElementById("backup-percentage").className+=" bg-warning");for(var e,f=0;f<a.Warnings.length;f++){e=a.Warnings[f],akeebabackup.System.notification.notify(Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_BACKUPWARNING"),e);var g=document.createElement("div");g.className="mt-2 border-bottom pt-1 pb-1",g.textContent=e,document.getElementById("warnings-list").appendChild(g)}document.getElementById("backup-warnings-panel").style.display="block"}var h=a.Error;if(""!=h){try{console.error("Got an error message"),console.log(h)}catch(a){}return void akeebabackup.Backup.onError(h)}if(1==a.HasRun){try{console.log("Backup complete"),console.log(h)}catch(a){}return void akeebabackup.Backup.onDone()}""==akeebabackup.Backup.tag&&(akeebabackup.Backup.tag="backend"),akeebabackup.Backup.backupid=a.backupid,akeebabackup.Backup.resume.retry=0;var j=10;a.hasOwnProperty("sleepTime")&&(j=a.sleepTime);try{console.log("Starting tick timer with waitTime = "+j+" msec")}catch(a){}akeebabackup.Backup.timer(j)},akeebabackup.Backup.resumeBackup=function(){akeebabackup.Backup.resetRetryTimeoutBar(),document.getElementById("error-panel").style.display="none",document.getElementById("retry-panel").style.display="none",document.getElementById("backup-progress-pane").style.display="block",akeebabackup.Backup.resume.showWarnings&&(document.getElementById("backup-warnings-panel").style.display="block");var a=new Date;return akeebabackup.System.notification.notify(Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_BACKUPRESUME")+" "+a.toLocaleString()),akeebabackup.Backup.timer(),!1},akeebabackup.Backup.cancelResume=function(){akeebabackup.Backup.resetRetryTimeoutBar();var a=document.getElementById("backup-error-message-retry").innerHTML;return akeebabackup.Backup.endWithError(a),!1},akeebabackup.Backup.onError=function(a){if(!Joomla.getOptions("akeebabackup.Backup.resume.enabled",!0))return void akeebabackup.Backup.endWithError(a);if(akeebabackup.Backup.resume.retry>=Joomla.getOptions("akeebabackup.Backup.resume.maxRetries",3))return void akeebabackup.Backup.endWithError(a);akeebabackup.Backup.resume.retry++,akeebabackup.Backup.resetRetryTimeoutBar();var b=Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_BACKUPHALT_DESC"),c=Joomla.getOptions("akeebabackup.Backup.resume.timeout",10),d=b.replace("%d",c.toFixed(0));akeebabackup.System.notification.notify(Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_BACKUPHALT"),d),akeebabackup.Backup.resume.showWarnings="none"!==document.getElementById("backup-warnings-panel").style.display,document.getElementById("backup-progress-pane").style.display="none",document.getElementById("backup-warnings-panel").style.display="none",document.getElementById("error-panel").style.display="none",document.getElementById("backup-error-message-retry").textContent=a,document.getElementById("retry-panel").style.display="block",akeebabackup.Backup.startRetryTimeoutBar()},akeebabackup.Backup.endWithError=function(a){akeebabackup.Backup.resetTimeoutBar();var b=!1;document.getElementById("backup-progress-pane").style.display="none",document.getElementById("backup-warnings-panel").style.display="none",document.getElementById("retry-panel").style.display="none";var c=Joomla.getOptions("akeebabackup.Backup.URLs.LogURL",""),d=c+"&tag="+akeebabackup.Backup.tag,e=Joomla.getOptions("akeebabackup.Backup.URLs.AliceURL","")+"&log="+akeebabackup.Backup.tag;akeebabackup.Backup.backupid&&(d=d+"."+encodeURIComponent(akeebabackup.Backup.backupid),e=e+"."+encodeURIComponent(akeebabackup.Backup.backupid)),"finale"==akeebabackup.Backup.currentDomain&&(b=!0,e+="&autorun=1"),document.getElementById("ab-viewlog-error").setAttribute("href",d),document.getElementById("ab-alice-error").setAttribute("href",e),akeebabackup.System.notification.notify(Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_BACKUPFAILED"),a),akeebabackup.System.doAjax({ajax:"pushFail",tag:akeebabackup.Backup.tag,backupid:akeebabackup.Backup.backupid,errorMessage:a},function(){}),document.getElementById("backup-error-message").textContent=a,document.getElementById("error-panel").style.display="block",b&&setTimeout(function(){window.location=e},500)},akeebabackup.Backup.onDone=function(){var a=new Date;akeebabackup.System.notification.notify(Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_BACKUPFINISHED")+" "+a.toLocaleString()),akeebabackup.Backup.resetTimeoutBar(),document.getElementById("backup-progress-pane").style.display="none",document.getElementById("backup-complete").style.display="block",document.getElementById("backup-warnings-panel").style.width="100%";var b=Joomla.getOptions("akeebabackup.Backup.URLs.LogURL",""),c=b+"&tag="+akeebabackup.Backup.tag;akeebabackup.Backup.tag?akeebabackup.Backup.backupid&&(c=c+"."+encodeURIComponent(akeebabackup.Backup.backupid)):c=b+"&latest=1";try{document.getElementById("ab-viewlog-success").setAttribute("href",c)}catch(a){}var d=Joomla.getOptions("akeebabackup.Backup.returnUrl",akeebabackup.Backup.returnUrl);""!=d&&(window.location=d)},akeebabackup.Backup.restoreDefaultOptions=function(){document.getElementById("backup-description").value=Joomla.getOptions("akeebabackup.Backup.defaultDescription",""),document.getElementById("comment").value="ThisIsADummyStringToWorkAroundChrome",document.getElementById("comment").value=""},akeebabackup.Backup.flipProfile=function(){document.getElementById("flipDescription").value=document.getElementById("backup-description").value,document.getElementById("flipComment").value=document.getElementById("comment").value,setTimeout(function(){document.forms.flipForm.submit()},500)},akeebabackup.System.documentReady(function(){akeebabackup.System.notification.askPermission(),akeebabackup.System.addEventListener("comAkeebaControlPanelProfileSwitch","choice",akeebabackup.Backup.flipProfile),akeebabackup.System.addEventListener("comAkeebaBackupCancelResume","click",akeebabackup.Backup.cancelResume),akeebabackup.System.addEventListener("comAkeebaBackupResumeBackup","click",akeebabackup.Backup.resumeBackup),Joomla.getOptions("akeebabackup.Backup.autostart")?akeebabackup.Backup.start():(akeebabackup.System.addEventListener("backup-start","click",akeebabackup.Backup.start),akeebabackup.System.addEventListener("backup-default","click",akeebabackup.Backup.restoreDefaultOptions))});
//# sourceMappingURL=Backup.min.js.map