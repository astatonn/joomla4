"use strict";if("undefined"==typeof akeebabackup)var akeebabackup={};"undefined"==typeof akeebabackup.Restore&&(akeebabackup.Restore={lastResponseSeconds:0,timer:0,errorCallback:null,statistics:{inbytes:0,outbytes:0,files:0},factory:null}),akeebabackup.Restore.errorCallbackDefault=function(a){document.getElementById("restoration-progress").style.display="none",document.getElementById("restoration-error").style.display="block",document.getElementById("backup-error-message").innerHTML=a},akeebabackup.Restore.doAjax=function(a,b,c){var d=JSON.stringify(a),e={json:d},f=Joomla.getOptions("akeebabackup.Restore.password","");0<f.length&&(e.password=f);var g=new Date().getTime()/1e3,h=parseInt(g,10);e._cacheBustingJunk=Math.round(1e3*(g-h));var i={type:"POST",url:Joomla.getOptions("akeebabackup.Restore.ajaxURL",""),cache:!1,data:e,timeout:6e5,success:function success(a){var d=null,e="",f=a.indexOf("###");if(-1==f)return a="Invalid AJAX data: "+a,void(null==c?null==akeebabackup.Restore.errorCallback?akeebabackup.Restore.errorCallbackDefault(a):akeebabackup.Restore.errorCallback(a):c(a));0==f?e=a:(d=a.substr(0,f),e=a.substr(f));e=e.substr(3),f=e.lastIndexOf("###"),e=e.substr(0,f);try{var g=JSON.parse(e)}catch(a){var h=a.message+"\n<br/>\n<pre>\n"+e+"\n</pre>";return void(null==c?null==akeebabackup.Restore.errorCallback?akeebabackup.Restore.errorCallbackDefault(h):akeebabackup.Restore.errorCallback(h):c(h))}b(g)},error:function error(a,b){var d=a.responseText?a.responseText:"",e="<strong>AJAX Loading Error</strong><br/>HTTP Status: "+a.status+" ("+a.statusText+")<br/>";e=e+"Internal status: "+b+"<br/>",e=e+"XHR ReadyState: "+a.readyState+"<br/>",e=e+"Raw server response:<br/>"+akeebabackup.System.sanitizeErrorMessage(d),null==c?null==akeebabackup.Restore.errorCallback?akeebabackup.Restore.errorCallbackDefault(e):akeebabackup.Restore.errorCallback(e):c(e)}};akeebabackup.Ajax.ajax(i)},akeebabackup.Restore.startTimeoutBar=function(){akeebabackup.Restore.resetTimeoutBar(),akeebabackup.Restore.timer=setInterval(function(){akeebabackup.Restore.lastResponseSeconds++;var a=Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_LASTRESPONSE").replace("%s",akeebabackup.Restore.lastResponseSeconds.toFixed(0));try{document.getElementById("response-timer").querySelector("div.text").textContent=a}catch(a){}},1e3)},akeebabackup.Restore.resetTimeoutBar=function(){if(akeebabackup.Restore.lastResponseSeconds=0,0!=akeebabackup.Restore.timer){clearInterval(akeebabackup.Restore.timer),akeebabackup.Restore.timer=0;var a=document.getElementById("response-timer").querySelector("div.text"),b=Joomla.Text._("COM_AKEEBABACKUP_BACKUP_TEXT_LASTRESPONSE").replace("%s","0");try{a.textContent=b}catch(a){}}},akeebabackup.Restore.pingRestoration=function(){akeebabackup.Restore.statistics.inbytes=0,akeebabackup.Restore.statistics.outbytes=0,akeebabackup.Restore.statistics.files=0;akeebabackup.Restore.startTimeoutBar(5e3,80),akeebabackup.Restore.doAjax({task:"ping"},function(a){akeebabackup.Restore.start(a)})},akeebabackup.Restore.start=function(){akeebabackup.Restore.statistics.inbytes=0,akeebabackup.Restore.statistics.outbytes=0,akeebabackup.Restore.statistics.files=0;akeebabackup.Restore.startTimeoutBar(5e3,80),akeebabackup.Restore.doAjax({task:"startRestore"},function(a){akeebabackup.Restore.step(a)})},akeebabackup.Restore.step=function(a){if(akeebabackup.Restore.resetTimeoutBar(),!1==a.status)akeebabackup.Restore.errorCallbackDefault(a.message);else if(a.done)akeebabackup.Restore.factory=a.factory,document.getElementById("restoration-progress").style.display="none",document.getElementById("restoration-extract-ok").style.display="block";else{akeebabackup.Restore.statistics.inbytes+=a.bytesIn,akeebabackup.Restore.statistics.outbytes+=a.bytesOut,akeebabackup.Restore.statistics.files+=a.files;try{document.getElementById("extbytesin").textContent=akeebabackup.Restore.statistics.inbytes,document.getElementById("extbytesout").textContent=akeebabackup.Restore.statistics.outbytes,document.getElementById("extfiles").textContent=akeebabackup.Restore.statistics.files}catch(a){}var b={task:"stepRestore",factory:a.factory};akeebabackup.Restore.startTimeoutBar(5e3,80),akeebabackup.Restore.doAjax(b,function(a){akeebabackup.Restore.step(a)})}},akeebabackup.Restore.finalize=function(a){a.preventDefault();var b={task:"finalizeRestore",factory:akeebabackup.Restore.factory};return akeebabackup.Restore.startTimeoutBar(5e3,80),akeebabackup.Restore.doAjax(b,function(a){akeebabackup.Restore.finished(a)}),!1},akeebabackup.Restore.finished=function(){window.location=Joomla.getOptions("akeebabackup.Restore.mainURL",window.location)},akeebabackup.Restore.runInstaller=function(a){a.preventDefault(),window.open("../installation/index.php","abiinstaller");var b=document.getElementById("restoration-runinstaller"),c=document.getElementById("restoration-finalize");return b.className="btn btn-outline-dark btn-sm me-3",c.style.display="block",!1},akeebabackup.Restore.restoreDefaultOptions=function(){var a=document.getElementById("jps_key");a&&(a.value="ThisIsADummyStringToWorkAroundChrome",a.value="")},akeebabackup.Restore.onProcEngineChange=function(){var a=document.getElementById("procengine");"direct"===a.options[a.selectedIndex].value?(document.getElementById("ftpOptions").style.display="none",document.getElementById("testftp").style.display="none"):(document.getElementById("ftpOptions").style.display="block",document.getElementById("testftp").style.display="inline-block")},akeebabackup.System.documentReady(function(){return Joomla.getOptions("akeebabackup.Restore.inMainRestoration",!1)?(document.getElementById("restoration-runinstaller").addEventListener("click",akeebabackup.Restore.runInstaller),document.getElementById("restoration-finalize").addEventListener("click",akeebabackup.Restore.finalize),void akeebabackup.Restore.pingRestoration()):void(document.getElementById("backup-start").addEventListener("click",function(a){return a.preventDefault(),document.adminForm.submit(),!1}),document.getElementById("testftp").addEventListener("click",function(a){return a.preventDefault(),akeebabackup.Configuration.FtpTest.testConnection("testftp","ftp"),!1}),document.getElementById("procengine").addEventListener("change",akeebabackup.Restore.onProcEngineChange),akeebabackup.Restore.onProcEngineChange(),setTimeout(akeebabackup.Restore.restoreDefaultOptions,500))});
//# sourceMappingURL=Restore.min.js.map